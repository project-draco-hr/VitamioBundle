{
  LayoutParams lp=getLayoutParams();
  int windowWidth=DeviceUtils.getScreenWidth(mActivity);
  int windowHeight=DeviceUtils.getScreenHeight(mActivity);
  float windowRatio=windowWidth / (float)windowHeight;
  float videoRatio=userRatio <= 0.01f ? videoAspectRatio : userRatio;
  mSurfaceHeight=videoHeight;
  mSurfaceWidth=videoWidth;
  if (VIDEO_LAYOUT_ORIGIN == mVideoMode && mSurfaceWidth < windowWidth && mSurfaceHeight < windowHeight) {
    lp.width=(int)(mSurfaceHeight * videoRatio);
    lp.height=mSurfaceHeight;
  }
 else   if (mVideoMode == VIDEO_LAYOUT_ZOOM) {
    lp.width=windowRatio > videoRatio ? windowWidth : (int)(videoRatio * windowHeight);
    lp.height=windowRatio < videoRatio ? windowHeight : (int)(windowWidth / videoRatio);
  }
 else   if (mVideoMode == VIDEO_LAYOUT_SCALE_ZOOM && mVideoHeight > 0) {
    lp.width=(int)(mVideoHeight * videoRatio);
    lp.height=mVideoHeight;
  }
 else {
    boolean full=mVideoMode == VIDEO_LAYOUT_STRETCH;
    lp.width=(full || windowRatio < videoRatio) ? windowWidth : (int)(videoRatio * windowHeight);
    lp.height=(full || windowRatio > videoRatio) ? windowHeight : (int)(windowWidth / videoRatio);
  }
  mVideoHeight=lp.height;
  setLayoutParams(lp);
  getHolder().setFixedSize(mSurfaceWidth,mSurfaceHeight);
  Log.d("VIDEO: %dx%dx%f, Surface: %dx%d, LP: %dx%d, Window: %dx%dx%f",videoWidth,videoHeight,videoAspectRatio,mSurfaceWidth,mSurfaceHeight,lp.width,lp.height,windowWidth,windowHeight,windowRatio);
}
